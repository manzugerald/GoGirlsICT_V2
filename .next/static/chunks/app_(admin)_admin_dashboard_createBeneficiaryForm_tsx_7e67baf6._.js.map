{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/GERALD/Desktop/NEXT/gogirlsict/app/%28admin%29/admin/dashboard/createBeneficiaryForm.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect, ChangeEvent } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Label } from '@/components/ui/label';\r\n\r\n// ... enums and types as before ...\r\n\r\nexport default function CreateBeneficiaryForm({\r\n  mode,\r\n  initialData,\r\n  onSuccess,\r\n  onCancel,\r\n}: {\r\n  mode: Mode;\r\n  initialData?: BeneficiaryData;\r\n  onSuccess?: () => void;\r\n  onCancel?: () => void;\r\n}) {\r\n  // ... all useState/useEffect logic as before ...\r\n\r\n  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n\r\n    try {\r\n      // --- 1. Create Beneficiary via API ---\r\n      const formData = new FormData();\r\n      formData.append('firstName', form.firstName.trim());\r\n      formData.append('lastName', form.lastName.trim());\r\n      formData.append('gender', form.gender);\r\n      formData.append('dateOfBirth', form.dateOfBirth);\r\n      if (form.email) formData.append('email', form.email.trim());\r\n      if (form.phone) formData.append('phone', form.phone.trim());\r\n      if (form.institutionId) formData.append('institutionId', form.institutionId);\r\n      formData.append('beneficiaryStatus', form.beneficiaryStatus);\r\n\r\n      // Profile images\r\n      imageFiles.forEach((file) => {\r\n        formData.append('images', file);\r\n      });\r\n\r\n      let res;\r\n      let beneficiary: any;\r\n      if (mode === 'edit' && initialData?.id) {\r\n        // PATCH, not supported in this refactor (see note below)\r\n        res = await fetch(`/api/beneficiaries/${initialData.id}`, {\r\n          method: 'PATCH',\r\n          body: formData,\r\n        });\r\n        beneficiary = await res.json();\r\n      } else {\r\n        // POST new\r\n        res = await fetch('/api/beneficiaries', {\r\n          method: 'POST',\r\n          body: formData,\r\n        });\r\n        if (!res.ok) {\r\n          const errorData = await res.json().catch(() => null);\r\n          throw new Error(\r\n            errorData?.error ||\r\n              (mode === 'edit' ? 'Failed to update beneficiary' : 'Failed to create beneficiary')\r\n          );\r\n        }\r\n        beneficiary = await res.json();\r\n      }\r\n\r\n      // --- 2. POST Requests to /api/beneficiaryRequests ---\r\n      for (const req of requests) {\r\n        await fetch('/api/beneficiaryRequests', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            beneficiaryId: beneficiary.id,\r\n            title: req.title,\r\n            beneficiaryRequestText: req.beneficiaryRequestText,\r\n            status: req.status || 'draft',\r\n          }),\r\n        });\r\n      }\r\n\r\n      // --- 3. POST Messages to /api/beneficiaryMessages ---\r\n      for (const msg of messages) {\r\n        await fetch('/api/beneficiaryMessages', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            beneficiaryId: beneficiary.id,\r\n            title: msg.title,\r\n            beneficiaryMessageText: msg.message,\r\n            status: msg.status || 'draft',\r\n          }),\r\n        });\r\n      }\r\n\r\n      if (onSuccess) {\r\n        onSuccess();\r\n      } else {\r\n        router.refresh();\r\n        router.push('/admin');\r\n      }\r\n    } catch (err) {\r\n      console.error('Error saving beneficiary:', err);\r\n      alert(\r\n        `There was an error ${\r\n          mode === 'edit' ? 'updating' : 'creating'\r\n        } the beneficiary. Please try again.`\r\n      );\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // ...the rest of the form code is unchanged...\r\n}\r\n"],"names":[],"mappings":";;;AAAA;AAUe,SAAS,sBAAsB,EAC5C,IAAI,EACJ,WAAW,EACX,SAAS,EACT,QAAQ,EAMT;IACC,iDAAiD;IAEjD,MAAM,eAAe,OAAO;QAC1B,EAAE,cAAc;QAChB,WAAW;QAEX,IAAI;YACF,wCAAwC;YACxC,MAAM,WAAW,IAAI;YACrB,SAAS,MAAM,CAAC,aAAa,KAAK,SAAS,CAAC,IAAI;YAChD,SAAS,MAAM,CAAC,YAAY,KAAK,QAAQ,CAAC,IAAI;YAC9C,SAAS,MAAM,CAAC,UAAU,KAAK,MAAM;YACrC,SAAS,MAAM,CAAC,eAAe,KAAK,WAAW;YAC/C,IAAI,KAAK,KAAK,EAAE,SAAS,MAAM,CAAC,SAAS,KAAK,KAAK,CAAC,IAAI;YACxD,IAAI,KAAK,KAAK,EAAE,SAAS,MAAM,CAAC,SAAS,KAAK,KAAK,CAAC,IAAI;YACxD,IAAI,KAAK,aAAa,EAAE,SAAS,MAAM,CAAC,iBAAiB,KAAK,aAAa;YAC3E,SAAS,MAAM,CAAC,qBAAqB,KAAK,iBAAiB;YAE3D,iBAAiB;YACjB,WAAW,OAAO,CAAC,CAAC;gBAClB,SAAS,MAAM,CAAC,UAAU;YAC5B;YAEA,IAAI;YACJ,IAAI;YACJ,IAAI,SAAS,UAAU,aAAa,IAAI;gBACtC,yDAAyD;gBACzD,MAAM,MAAM,MAAM,CAAC,mBAAmB,EAAE,YAAY,EAAE,EAAE,EAAE;oBACxD,QAAQ;oBACR,MAAM;gBACR;gBACA,cAAc,MAAM,IAAI,IAAI;YAC9B,OAAO;gBACL,WAAW;gBACX,MAAM,MAAM,MAAM,sBAAsB;oBACtC,QAAQ;oBACR,MAAM;gBACR;gBACA,IAAI,CAAC,IAAI,EAAE,EAAE;oBACX,MAAM,YAAY,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM;oBAC/C,MAAM,IAAI,MACR,WAAW,SACT,CAAC,SAAS,SAAS,iCAAiC,8BAA8B;gBAExF;gBACA,cAAc,MAAM,IAAI,IAAI;YAC9B;YAEA,uDAAuD;YACvD,KAAK,MAAM,OAAO,SAAU;gBAC1B,MAAM,MAAM,4BAA4B;oBACtC,QAAQ;oBACR,SAAS;wBAAE,gBAAgB;oBAAmB;oBAC9C,MAAM,KAAK,SAAS,CAAC;wBACnB,eAAe,YAAY,EAAE;wBAC7B,OAAO,IAAI,KAAK;wBAChB,wBAAwB,IAAI,sBAAsB;wBAClD,QAAQ,IAAI,MAAM,IAAI;oBACxB;gBACF;YACF;YAEA,uDAAuD;YACvD,KAAK,MAAM,OAAO,SAAU;gBAC1B,MAAM,MAAM,4BAA4B;oBACtC,QAAQ;oBACR,SAAS;wBAAE,gBAAgB;oBAAmB;oBAC9C,MAAM,KAAK,SAAS,CAAC;wBACnB,eAAe,YAAY,EAAE;wBAC7B,OAAO,IAAI,KAAK;wBAChB,wBAAwB,IAAI,OAAO;wBACnC,QAAQ,IAAI,MAAM,IAAI;oBACxB;gBACF;YACF;YAEA,IAAI,WAAW;gBACb;YACF,OAAO;gBACL,OAAO,OAAO;gBACd,OAAO,IAAI,CAAC;YACd;QACF,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,6BAA6B;YAC3C,MACE,CAAC,mBAAmB,EAClB,SAAS,SAAS,aAAa,WAChC,mCAAmC,CAAC;QAEzC,SAAU;YACR,WAAW;QACb;IACF;AAEA,+CAA+C;AACjD;KA1GwB","debugId":null}}]
}